<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Push Back Practice Dashboard</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
button, select, input { padding: 6px; margin: 4px; }

table { border-collapse: collapse; width: 100%; margin-top: 15px; }
th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
th { background: #eee; }
.good { background: #c8f7c5; }
.bad { background: #f7c5c5; }

#fieldContainer { position: relative; width: 900px; height: 900px; margin-top: 20px; }
#fieldImage { width: 100%; height: 100%; display: block; pointer-events: none; }
#fieldCanvas { position: absolute; top: 0; left: 0; cursor: crosshair; }
</style>
</head>

<body>

<h2>VEX Push Back Practice</h2>

<h3>Section Setup</h3>
<table>
<thead>
<tr><th>Name</th><th>Distance (miles)</th><th>Delete</th></tr>
</thead>
<tbody id="sectionTable"></tbody>
</table>
<button onclick="addSection()">Add Section</button>

<hr>

<label>Mode:</label>
<select id="mode" onchange="renderResults(); loadSectionPaths();">
  <option value="driver">Driver</option>
  <option value="auton">Auton</option>
</select>

<br><br>

<label>Section:</label>
<select id="sectionSelect" onchange="loadSectionPaths()"></select>

<button onclick="startSection()">Start</button>
<button onclick="stopSection()">Stop</button>

<p id="timer">Time: 0.00 s</p>

<h3>Results</h3>
<table>
<thead>
<tr>
  <th>Section</th>
  <th>Best (s)</th>
  <th>Current (s)</th>
  <th>Î” vs Best</th>
  <th>Speed (MPH)</th>
  <th>Delete</th>
</tr>
</thead>
<tbody id="resultsTable"></tbody>
</table>

<h3>Field Map</h3>
<div id="fieldContainer">
  <img id="fieldImage" src="field.png">
  <canvas id="fieldCanvas" width="900" height="900"></canvas>
</div>
<button onclick="clearPaths()">Clear Paths</button>

<script>
/* ---------- DATA ---------- */
let sections = JSON.parse(localStorage.getItem("sections")) || [{ name:"Start to Goal", distance:1 }];
let runs = JSON.parse(localStorage.getItem("runs")) || { driver:{}, auton:{} };
let pathsPerSection = JSON.parse(localStorage.getItem("pathsPerSection")) || { driver:{}, auton:{} };

let startTime=null, timerInterval=null, activeSection=null;

/* ---------- INIT ---------- */
renderSectionSetup();
renderSectionDropdown();
renderResults();
loadSectionPaths();

/* ---------- SECTION SETUP ---------- */
function renderSectionSetup(){
  const t=document.getElementById("sectionTable");
  t.innerHTML="";
  sections.forEach((s,i)=>{
    const r=t.insertRow();
    const n=document.createElement("input");
    n.value=s.name;
    n.onchange=()=>{sections[i].name=n.value; save();};
    const d=document.createElement("input");
    d.type="number"; d.step="0.01"; d.value=s.distance;
    d.onchange=()=>{sections[i].distance=parseFloat(d.value)||1; save();};
    const del=document.createElement("button");
    del.textContent="ðŸ—‘";
    del.onclick=()=>{
      sections.splice(i,1);
      const m=document.getElementById("mode").value;
      if(pathsPerSection[m]) delete pathsPerSection[m][i];
      save();
    };
    r.insertCell().appendChild(n);
    r.insertCell().appendChild(d);
    r.insertCell().appendChild(del);
  });
}

function addSection(){
  sections.push({name:"New Section",distance:1});
  save();
}

function save(){
  localStorage.setItem("sections",JSON.stringify(sections));
  localStorage.setItem("runs",JSON.stringify(runs));
  localStorage.setItem("pathsPerSection",JSON.stringify(pathsPerSection));
  renderSectionSetup();
  renderSectionDropdown();
  renderResults();
}

/* ---------- DROPDOWN ---------- */
function renderSectionDropdown(){
  const s=document.getElementById("sectionSelect");
  s.innerHTML="";
  sections.forEach((sec,i)=>{
    const o=document.createElement("option");
    o.value=i; o.textContent=sec.name;
    s.appendChild(o);
  });
  if(activeSection===null && sections.length) activeSection=0;
  document.getElementById("sectionSelect").value=activeSection;
  loadSectionPaths();
}

/* ---------- TIMER ---------- */
function startSection(){
  if(timerInterval) return;
  activeSection=parseInt(document.getElementById("sectionSelect").value);
  startTime=performance.now();
  timerInterval=setInterval(()=>{
    document.getElementById("timer").textContent=
      "Time: "+((performance.now()-startTime)/1000).toFixed(2)+" s";
  },30);
}

function stopSection(){
  if(!timerInterval) return;
  clearInterval(timerInterval);
  timerInterval=null;
  const t=(performance.now()-startTime)/1000;
  const m=document.getElementById("mode").value;
  runs[m][activeSection] = runs[m][activeSection] || [];
  runs[m][activeSection].push(t);
  save();
  renderResults();
}

/* ---------- RESULTS ---------- */
function renderResults(){
  const tb=document.getElementById("resultsTable");
  tb.innerHTML="";
  const m=document.getElementById("mode").value;
  sections.forEach((s,i)=>{
    const data=runs[m][i]||[];
    const best = data.length ? Math.min(...data) : null;
    const cur = data.length ? data[data.length-1] : null;

    const r=tb.insertRow();
    r.insertCell().textContent=s.name;
    r.insertCell().textContent=(best!==null)?best.toFixed(2):"â€”";
    r.insertCell().textContent=(cur!==null)?cur.toFixed(2):"â€”";
    const d=r.insertCell();
    d.textContent=(cur!==null && best!==null)?(cur-best).toFixed(2):"â€”";
    d.className=(cur!==null && best!==null && cur<=best)?"good":"bad";
    r.insertCell().textContent=(cur!==null)?((s.distance*3600)/cur).toFixed(2)+" mph":"â€”";

    const del=document.createElement("button");
    del.textContent="ðŸ—‘";
    del.onclick=()=>{
      if(data.length) data.pop();
      save();
    };
    r.insertCell().appendChild(del);
  });
  drawPaths();
}

/* ---------- PATH DRAWING ---------- */
const canvas=document.getElementById("fieldCanvas");
const ctx=canvas.getContext("2d");

let paths=[], currentPath=null;

canvas.addEventListener("mousedown",e=>{
  const r=canvas.getBoundingClientRect();
  currentPath=[{x:e.clientX-r.left,y:e.clientY-r.top}];
  paths.push(currentPath);
  savePaths();
});

canvas.addEventListener("mousemove",e=>{
  if(!currentPath) return;
  const r=canvas.getBoundingClientRect();
  currentPath.push({x:e.clientX-r.left,y:e.clientY-r.top});
  drawPaths();
  savePaths();
});

canvas.addEventListener("mouseup",()=>{currentPath=null;});

function drawPaths(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.lineWidth=3;
  ctx.font="20px Arial";

  const m=document.getElementById("mode").value;
  const data=runs[m][activeSection]||[];
  const bestIndex=data.indexOf(Math.min(...data));

  paths.forEach((p,i)=>{
    ctx.strokeStyle = (i===bestIndex) ? "green" : "blue";
    ctx.fillStyle = (i===bestIndex) ? "green" : "red";

    ctx.beginPath();
    p.forEach((pt,j)=>j?ctx.lineTo(pt.x,pt.y):ctx.moveTo(pt.x,pt.y));
    ctx.stroke();
    ctx.fillText(i+1, p[0].x+5, p[0].y-5);
  });
}

function clearPaths(){
  paths=[];
  savePaths();
  drawPaths();
}

function savePaths(){
  if(activeSection===null) return;
  const m=document.getElementById("mode").value;
  if(!pathsPerSection[m]) pathsPerSection[m]={};
  pathsPerSection[m][activeSection]=paths;
  localStorage.setItem("pathsPerSection",JSON.stringify(pathsPerSection));
}

function loadSectionPaths(){
  activeSection=parseInt(document.getElementById("sectionSelect").value);
  const m=document.getElementById("mode").value;
  paths = (pathsPerSection[m] && pathsPerSection[m][activeSection]) || [];
  drawPaths();
}
</script>

</body>
</html>
