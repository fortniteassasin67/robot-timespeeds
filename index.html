<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Push Back Practice Dashboard</title>

<style>
body { font-family: Arial, sans-serif; padding: 20px; }
button, select { padding: 6px; margin: 4px; }

table {
  border-collapse: collapse;
  width: 100%;
  margin-top: 15px;
}

th, td {
  border: 1px solid #ccc;
  padding: 6px;
  text-align: center;
}

th { background: #eee; }
.good { background: #c8f7c5; }
.bad { background: #f7c5c5; }

#fieldContainer {
  position: relative;
  width: 900px;
  height: 900px;
  margin-top: 20px;
}

#fieldImage {
  width: 100%;
  height: 100%;
  display: block;
}

#fieldCanvas {
  position: absolute;
  top: 0;
  left: 0;
}
</style>
</head>

<body>

<h2>VEX Push Back Practice</h2>

<label>Mode:</label>
<select id="mode" onchange="renderTable()">
  <option value="driver">Driver</option>
  <option value="auton">Auton</option>
</select>

<br><br>

<label>Section:</label>
<select id="sectionSelect"></select>

<button onclick="startSection()">Start</button>
<button onclick="stopSection()">Stop</button>

<p id="timer">Time: 0.00 s</p>

<table>
<thead>
<tr>
  <th>Section</th>
  <th>Best</th>
  <th>Current</th>
  <th>Î” vs Best</th>
  <th>Speed</th>
  <th>Delete</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

<h3>Field Map</h3>
<div id="fieldContainer">
  <img id="fieldImage" src="field.png">
  <canvas id="fieldCanvas" width="900" height="900"></canvas>
</div>

<button onclick="clearPath()">Clear Path</button>

<script>
/* ---------- DATA ---------- */
const sections = [
  { name: "Start to Goal", distance: 1 },
  { name: "Push Block", distance: 1 },
  { name: "Return", distance: 1 }
];

let runs = JSON.parse(localStorage.getItem("runs")) || { driver:{}, auton:{} };

let startTime = null;
let timerInterval = null;
let activeSection = null;

/* ---------- INIT ---------- */
const sectionSelect = document.getElementById("sectionSelect");
sections.forEach((s,i)=>{
  const opt = document.createElement("option");
  opt.value = i;
  opt.textContent = s.name;
  sectionSelect.appendChild(opt);
});
renderTable();

/* ---------- TIMER ---------- */
function startSection() {
  if (timerInterval !== null) return;

  activeSection = sectionSelect.value;
  startTime = performance.now();

  timerInterval = setInterval(() => {
    const elapsed = (performance.now() - startTime) / 1000;
    document.getElementById("timer").textContent =
      "Time: " + elapsed.toFixed(2) + " s";
  }, 30);
}

function stopSection() {
  if (timerInterval === null) return;

  clearInterval(timerInterval);
  timerInterval = null;

  const elapsed = (performance.now() - startTime) / 1000;
  document.getElementById("timer").textContent =
    "Time: " + elapsed.toFixed(2) + " s";

  const mode = document.getElementById("mode").value;
  runs[mode][activeSection] ??= [];
  runs[mode][activeSection].push(elapsed);

  localStorage.setItem("runs", JSON.stringify(runs));
  renderTable();
}

/* ---------- TABLE ---------- */
function renderTable() {
  const tbody = document.getElementById("tableBody");
  tbody.innerHTML = "";
  const mode = document.getElementById("mode").value;

  sections.forEach((s,i)=>{
    const data = runs[mode][i];
    if (!data || data.length === 0) return;

    const best = Math.min(...data);
    const current = data[data.length - 1];
    const delta = current - best;
    const speed = s.distance / current;

    const row = tbody.insertRow();
    row.insertCell().textContent = s.name;
    row.insertCell().textContent = best.toFixed(2);
    row.insertCell().textContent = current.toFixed(2);

    const d = row.insertCell();
    d.textContent = delta.toFixed(2);
    d.className = delta <= 0 ? "good" : "bad";

    row.insertCell().textContent = speed.toFixed(2);

    const del = row.insertCell();
    const btn = document.createElement("button");
    btn.textContent = "ðŸ—‘";
    btn.onclick = () => {
      data.pop();
      localStorage.setItem("runs", JSON.stringify(runs));
      renderTable();
    };
    del.appendChild(btn);
  });
}

/* ---------- DRAWING ---------- */
const canvas = document.getElementById("fieldCanvas");
const ctx = canvas.getContext("2d");
let drawing = false;
let path = [];

canvas.addEventListener("mousedown", e=>{drawing=true; addPoint(e);});
canvas.addEventListener("mousemove", e=>{if(drawing) addPoint(e);});
canvas.addEventListener("mouseup", ()=>drawing=false);

function addPoint(e){
  const r = canvas.getBoundingClientRect();
  path.push({x:e.clientX-r.left, y:e.clientY-r.top});
  drawPath();
}

function drawPath(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.beginPath();
  ctx.strokeStyle="blue";
  ctx.lineWidth=3;
  path.forEach((p,i)=>i?ctx.lineTo(p.x,p.y):ctx.moveTo(p.x,p.y));
  ctx.stroke();
}

function clearPath(){
  path=[];
  drawPath();
}
</script>

</body>
</html>
